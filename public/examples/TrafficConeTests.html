<!DOCTYPE html>
<html lang="en">
<head>
    <title></title>
    <meta http-equiv="pragma" content="no-cache">
    <script type="text/javascript" src="../tccore/jquery.min.js"></script>
    <!--[if IE]><script src="excanvas.compiled.js"></script><![endif]-->
    <script type="text/javascript" src="../tccore/LoadShim.js"></script>
    <script type="text/javascript" src="../tccore/NotConstants.js"></script>
    <script type="text/javascript" src="../tccore/browserdetect.js"></script>
    <script type="text/javascript" src="../tccore/GameEvent.js"></script>
    <script type="text/javascript" src="../tccore/Frame.js"></script>
    <script type="text/javascript" src="../tccore/GameWorld.js"></script>
    <script type="text/javascript" src="../tccore/Sprite.js"></script>
    <script type="text/javascript" src="../tccore/SpriteInventory.js"></script>
    <script type="text/javascript" src="../tccore/GameWorldModel2D.js"></script>
    <script type="text/javascript" src="../tccore/GameWorldModelIso.js"></script>
    <script type="text/javascript" src="../tccore/Engine.js"></script>
    <script type="text/javascript" src="../assets/werewolf/werewolf.js"></script>
    <script type="text/javascript" src="../assets/ninjagirl/ninjaGirl.js"></script>
    <script type="text/javascript" src="../assets/zombie/zombie.js"></script>
    <script type="text/javascript" src="../assets/Cells/Cells.js"></script>
    <script type="text/javascript" src="../assets/Cells/singleColumn.js"></script>
    <script type="text/javascript" src="../assets/Cells/test2DCells.js"></script>
    <script type="text/javascript" src="../tccore/pathfinding/astar.js"></script>
    <script type="text/javascript" src="../tccore/pathfinding/BinaryHeap.js"></script>
    <script type="text/javascript" src="../tccore/behaviors/Seeker.js"></script>
    <script type="text/javascript" src="../tccore/behaviors/SpriteSeeker.js"></script>
    <script type="text/javascript" src="../tccore/behaviors/OriginSeeker.js"></script>
    <script type="text/javascript" src="Helpers.js"></script>
    <meta content="width=320, user-scalable=0" />
    <meta name="viewport" content="user-scalable=no, width=device-width, initial-scale=1.0, maximum-scale=1.0" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black" />
    <script language="javascript" type="text/javascript">

       function gameWorld_setCell(gameWorld, i, ii, sprite, frame, type, blockType, spriteId) {
	    	gameWorld.Cells[i][ii] = new Cell(sprite, frame, type, blockType, i, ii, spriteId);    
		}

 		function sheetLoaded() {

            if (backDrop.isLoadComplete()) {
                clearInterval(checkingId);
                ga.play();
            }
        }

        function sheetLoaded3() {
            var counter = 0;

            if (wolf.isLoadComplete() && worldCells.isLoadComplete()) {
                clearInterval(checkingId);
                ga.play();
                var counter = 0;
                var interval = setInterval(function () {
                    //move the sprite right 10 pixels
                    counter++;
                    wolf.moveRight();
                    ga.adjustCameraX(1);
                    if (counter > 10) {
                        clearInterval(interval);
                        ga.removeSprite("werewolf");
                        console.log("PASS");
                    }
                }, 100);
            }
        }


        function sheetLoaded2() {
            var counter = 0;
            if (backDrop.isLoadComplete() && worldCells.isLoadComplete()) {
                clearInterval(checkingId);
                //set the camera (center) to cell 10, row 10.
                ga.setCamera(10, 10);
                ga.play();
                var myinterval = setInterval(function () {
                    //move camera 10 cells to the right
                    ga.adjustCameraX(1);
                    counter++;
                    if (counter > 100) {
                        clearInterval(myinterval);
                        counter = 0;
                        myinterval = setInterval(function () {
                            //move camera 10 cells to the right
                            ga.adjustCameraX(-1);
                            counter++;
                            if (counter > 100) {
                                clearInterval(myinterval);
                                console.log("PASS");
                                ga.removeSprite("werewolf");
                            }
                        }, 100);
                    }
                }, 100);
            }

        }

        //todo: write a test for moving the world around a moving sprite
        //todo: write a test for composite sprite
        //todo: write test for in/out style scale movement


        //create:
        //todo: moveable backdrop, blocking edging, wrapping edges
        //background animations
        //static background sprites - block zones - texture drop
        //world concept? More then my current view
        //server side instancing
        //chat, locations
        //sockets instead of ajax?


        //Goal: RP Enfoced world
        //Goal: Location based card game



        var wolf;
        var backDrop;
        var worldCells;
        var checkingId;
        var ga;
        var ng;
        function ready() {
            //set up engine
            ga = new Engine(document.getElementById("gamescreen"), document.getElementById("backbuffer2"));

            //setup a backdrop image
            backDrop = new Sprite("backdrop");
            backDrop.setSpriteType("backdrop");
            backDrop.setup(ga);

            var bdImage = [];
            bdImage.push(new Frame(0, 0, 512, 860, 0));
            backDrop.defineSequence("backdrop", "../assets/londonsubway/londonSubway.png", bdImage, playInfinite);
            ga.setBackDrop(backDrop);
            checkingId = setInterval(sheetLoaded,100);

        }

        function animationLoop() {

            wolf = werewolf_Sprite(ga);
            wolf.setTop(50);
            wolf.setLeft(50);
            ga.defineSprite(wolf);
            var counter = 0;
            var interval = setInterval(function () {
                counter++;
                if (counter > 10) {
                    clearInterval(interval);
                    console.log("PASS");
                    ga.removeSprite("werewolf");
                }
            }, 1000);
        }

        function positionTests() {
            //create a sprite name
            wolf = werewolf_Sprite(ga);
            wolf.setTop(50);
            wolf.setLeft(50);


            //anchor defaults bottom/left
            //apply hook to frame change
            wolf.setWatcher("werewolfNeutral", testValue, WATCH_TYPE_ALL_FRAME);
            wolf.setWatcher("werewolfLunge", testValue, WATCH_TYPE_ALL_FRAME);

            ga.defineSprite(wolf);


        }

        function CreateNinjaGirlSprite() {
            var ng = ninjaGirl_Sprite(ga); wolf.setWatcher("werewolfNeutral", testValue, WATCH_TYPE_ALL_FRAME);
            wolf.setWatcher("werewolfLunge", testValue, WATCH_TYPE_ALL_FRAME);
            ng.setTop(50);
            ng.setLeft(50);


            //anchor defaults bottom/left
            //apply hook to frame change
            ng.setWatcher("ninjaGirlNeutral", testValue, WATCH_TYPE_ALL_FRAME);
            ng.setWatcher("ninjaGirlLightning", testValue, WATCH_TYPE_ALL_FRAME);
            ng.setWatcher("ninjaGirlGenerateMana", testValue, WATCH_TYPE_ALL_FRAME);
            ng.setWatcher("ninjaGirlDead", testValue, WATCH_TYPE_ALL_FRAME);

            ga.defineSprite(ng);

        }


        var lastLeft=0;
        var lastRight=0;
        var lastTop = 0;
        var lastBottom = 0;
        var lastState = "";
        var newTest = false;
        function testValue(sprite) {

            if (sprite.getSpriteState() != lastState) {
                newTest = true;
            }

            if (sprite.getSpriteState() == "werewolfNeutral") {
                HandleWereWolfNeutral(sprite);
            }

            if (sprite.getSpriteState() == "werewolfLunge") {
                HandleWereWolfLunge(sprite);
            }

            if (sprite.getSpriteState() == "ninjaGirlNeutral") {
                HandleNinjaGirl(sprite, "ninjaGirlLightning");
            }

            if (sprite.getSpriteState() == "ninjaGirlLightning") {
                HandleNinjaGirl(sprite, "ninjaGirlGenerateMana");
            }

            if (sprite.getSpriteState() == "ninjaGirlGenerateMana") {
                HandleNinjaGirl(sprite, "ninjaGirlDead");
            }

            if (sprite.getSpriteState() == "ninjaGirlDead") {
                HandleNinjaGirl(sprite, "");
            }

        }

        function HandleNinjaGirl(sprite, nextState) {
            //verify bottom left stays constant
            if (newTest) {
                reset(sprite);
                newTest = false;
            }
            else {
                //verify there has not been a change to right + bottom
                if (lastLeft != sprite.absoluteLeft()) {
                    console.log("Left: " + lastLeft + " " + sprite.absoluteLeft());
                    throw sprite.getSpriteState() + " left changed";
                }

                if (lastBottom != sprite.absoluteBottom()) {
                    console.log("Bottom: " + lastBottom + " " + sprite.absoluteBottom());
                    throw sprite.getSpriteState() + " bottom changed";
                }


                if (sprite.isLastFrame()) {
                    reset(sprite);
                    if (nextState != "") {
                        sprite.setSpriteState(nextState);
                    }
                    else {
                        ga.removeSprite(sprite.name);
                        console.log("PASS");
                    }
                }
            }
        }


        function HandleWereWolfLunge(sprite) {
            //verify top right stays constant
            if (newTest) {
                reset(sprite);
                newTest = false;
            }
            else {
                //verify there has not been a change to right + bottom
                if (lastLeft != sprite.absoluteLeft()) {
                    console.log("Left: " + lastLeft + " " + sprite.absoluteLeft());
                    throw "werewolfLunge left changed";
                }

                if (lastBottom != sprite.absoluteBottom()) {
                    console.log("Bottom: " + lastBottom + " " + sprite.absoluteBottom());
                    throw "werewolfLunge bottom changed";
                }

                console.log(sprite.getFrameCounter());
                if (sprite.isLastFrame()) {
                    reset(sprite);
                    ga.removeSprite(sprite.name);
                    CreateNinjaGirlSprite();
                }
            }

        }


        function HandleWereWolfNeutral(sprite)
        {
            //verify top right stays constant
            if (newTest)
            {
                reset(sprite);
                newTest = false;
            }
            else
            {
                //verify there has not been a change to right + bottom
                if (lastRight != sprite.absoluteRight())
                {
                    console.log("Right: " + lastRight + " " + sprite.absoluteRight());
                    throw "werewolfNeutral right changed";
                }

                if (lastBottom != sprite.absoluteBottom())
                {
                    console.log("Bottom: " + lastBottom + " " + sprite.absoluteBottom());
                    throw "werewolfNeutral lastBottom changed";
                }

                if (sprite.isLastFrame())
                {
                    reset(sprite);
                    sprite.setSpriteState("werewolfLunge");
                }

            }
        }

        var count = 0;
        function watcherTests(sprite) {
            if (sprite == undefined) {
                count = 0;
                var ng = ninjaGirl_Sprite(ga);
                ng.setTop(50);
                ng.setLeft(50);


                //anchor defaults bottom/left
                //apply hook to frame change
                ng.setWatcher("ninjaGirlNeutral", watcherTests, WATCH_TYPE_ALL_FRAME);
                ga.defineSprite( ng);
            }
            else {

                count++;
                if (sprite.getFrameCounter() != count) {
                    throw "callback out of sync";
                }
                if (sprite.isLastFrame()) {
                    if (count < 7) {
                        throw "animation ended prematurely";
                    }
                    else {
                        sprite.clearWatcher("ninjaGirlNeutral");
                        ga.removeSprite("ninjaGirl");
                        console.log("PASS");
                        return; //success
                    }
                }


                //count should never be greater then the number of ninjaGirlFrames
                if (count > 8) {
                    throw "animation never ended";
                }
            }

        }


        function lastFrameWatcherTests(sprite) {
            if (sprite == undefined) {
                count = 0;
                var ng = ninjaGirl_Sprite(ga);
                ng.setTop(50);
                ng.setLeft(50);

                //anchor defaults bottom/left
                //apply hook to frame change
                ng.setWatcher("ninjaGirlNeutral", lastFrameWatcherTests, WATCH_TYPE_LAST_FRAME);
                ga.defineSprite(ng);
            }
            else {

                if (!sprite.isLastFrame()) {
                    throw "Only throw on the last frame.";
                }
                else {
                    sprite.clearWatcher("ninjaGirlNeutral");
                    ga.removeSprite("ninjaGirl");
                    console.log("PASS");
                    return; //success
                }
            }

        }


        function targetFrameWatcherTests(sprite) {
            if (sprite == undefined) {
                count = 0;
                var ng = ninjaGirl_Sprite(ga);
                ng.setTop(50);
                ng.setLeft(50);


                //anchor defaults bottom/left
                //apply hook to frame change
                ng.setWatcher("ninjaGirlNeutral", targetFrameWatcherTests, 5);
                ga.defineSprite(ng);
            }
            else {

                if (sprite.getFrameCounter() != 5) {
                    throw "Only throw on the target frame.";
                }
                else {
                    sprite.clearWatcher("ninjaGirlNeutral");
                    ga.removeSprite("ninjaGirl");
                    console.log("PASS");
                    return; //success
                }
            }
        }

        function addRemoveSprite() {

            var ng = ninjaGirl_Sprite(ga);
            ng.setTop(50);
            ng.setLeft(50);


            var wolf = werewolf_Sprite(ga);
            wolf.setTop(50);
            wolf.setLeft(150);


            ga.defineSprite(ng);
            ga.defineSprite(wolf);

            //get the sprite back
            var sprite = ga.getSprite("ninjaGirl");
            if (sprite.name != "ninjaGirl") {
                throw "got wrong sprite!";
            }

            sprite = ga.getSprite("werewolf");
            if (sprite.name != "werewolf") {
                throw "got wrong sprite 2!";
            }

            //remove the sprites
            ga.removeSprite("ninjaGirl", function () {
                sprite = ga.getSprite("ninjaGirl");
                if (sprite != undefined) {
                    throw "sprite still exists";
                }
            });

            ga.removeSprite("werewolf", function () {
                sprite = ga.getSprite("werewolf");
                if (sprite != undefined) {
                    throw "sprite 2 still exists";
                }
            });
        }

        function reset(sprite) {
            lastLeft = sprite.absoluteLeft();
            lastRight = sprite.absoluteRight();
            lastTop = sprite.absoluteTop();
            lastBottom = sprite.absoluteBottom();
            lastState = sprite.getSpriteState();
            newTest = true;
        }

        var attachInputInit = -1;
        var attachInputInterval = 0;
        function attachInput() {

            if (attachInputInit == -1) {
                var ng = ninjaGirl_Sprite(ga);
                ng.setTop(50);
                ng.setLeft(50);
                ng.setDownSpeed(5);
                ng.setUpSpeed(5);

                ga.defineSprite(ng);

                //on mouse down, play the ninjaGirlLightning animation, call this function - do this three times.
                ga.addEventBehavior(ga.gameEvents.MouseDown, "", ng, "ninjaGirlLightning", attachInput, 3);
                attachInputInit = 0;
                attachInputInterval = setInterval(function () { checkSprite(ng); }, 3000);

            }
            else {

                if (attachInputInit > 3) {
                    throw "Input function called too many times!";
                }
                attachInputInit++;
            }
        }

        function checkSprite(ng) {
            if (ng.isLoadComplete()) {
                clearInterval(attachInputInterval);
                var event = new Object();
                event.type = "mousedown";
                ga.pushEvent(event);
                ga.pushEvent(event);
                ga.pushEvent(event);
                setTimeout(function () {
                    if (attachInputInit < 3) {
                        throw "Action function not invoked 3 times in 3 seconds.";
                    }
                    else {
                        ga.removeSprite("ninjaGirl");
                        console.log("PASS");
                    }
                }, 3000);
            }
        }

        var loadSprites = false;
        function collisionTest() {
            var ng = ninjaGirl_Sprite(ga);
            ng.setTop(50);
            ng.setLeft(0);
            ng.setSpeed(20);


            var wolf = werewolf_Sprite(ga);
            wolf.setTop(50);
            wolf.setLeft(100);
            wolf.setSpeed(10);


            ga.defineSprite(ng);
            ga.defineSprite(wolf);

            var counter =0;
            var interval = setInterval(function () {
                if (ng.isLoadComplete() && wolf.isLoadComplete()) {
                    //each second move sprites closer to one another.
                    //at this speed, this should collide in 5 seconds
                    ng.moveRight();
                    counter++;
                    if (counter > 5) {
                        throw "collision did not occur!";
                    }

                }
            }, 1000);

            ga.setCollisionHandler(function () {
                console.log("PASS");
                clearInterval(interval);
                ga.removeSprite("werewolf");
                ga.removeSprite("ninjaGirl");
            });
        }

        function getRand(max) {
            return Math.floor(Math.random()*max);
        }

        function compositeBackDrop(style) {

            if (style ==  GAME_WORLD_STYLE_2D) {
                Make2DWorld();
                checkingId = setInterval(sheetLoaded2, 100);
            }
            else{
                MakeIsometricWorld();
                checkingId = setInterval(function () {
                    var counter = 0;
                    if (backDrop.isLoadComplete() && worldCells.isLoadComplete()) {
                        clearInterval(checkingId);
                        //set the camera (center) to cell 10, row 10.
                        ga.setCamera(100, 100);
                        ga.play();
                        var myinterval = setInterval(function () {
                            //move camera 10 cells to the right
                            ga.adjustCameraX(1);
                            counter++;
                            if (counter > 100) {
                                clearInterval(myinterval);
                                counter = 0;
                                myinterval = setInterval(function () {
                                    //move camera 10 cells to the right
                                    ga.adjustCameraX(-1);
                                    counter++;
                                    if (counter > 100) {
                                        clearInterval(myinterval);
                                        console.log("PASS");
                                    }
                                }, 100);
                            }
                        }, 100);
                    }


                }, 100);

            }
        }


        function compositeBackDropWithSprite() {
            //set up new engine that will have a composite backdrop

            MakeIsometricWorld();

            wolf = werewolf_Sprite(ga);
            wolf.setTop(50);
            wolf.setLeft(50);
            wolf.setSpeed(10);
            wolf.setRightBorder(100);
            ga.defineSprite(wolf);
            ga.setCamera(100, 100);
            checkingId = setInterval(sheetLoaded3, 100);
        }



        function scalingDepth() {
            MakeIsometricWorld();
            ga.setCamera(125, 125);
            wolf = werewolf_Sprite(ga);
            wolf.setTop(ga.getCanvasHeight() - wolf.getHeight());
            wolf.setLeft(0);
            wolf.setSpeed(5);
            ga.defineSprite(wolf);

            checkingId = setInterval(function () {
                if (wolf.isLoadComplete() && worldCells.isLoadComplete()) {
                    clearInterval(checkingId);
                    ga.play();
                    var counter = 0;
                    var interval = setInterval(function () {
                        counter++;
                        if (counter < 50) {
                            wolf.moveOut();
                        }
                        if (counter > 50) {
                            wolf.moveIn();
                        }
                        if (counter > 100) {
                            clearInterval(interval);
                            console.log("PASS");
                            ga.removeSprite("werewolf");
                        }

                    }, 100);
                }


            }, 100);
        }


        function BlockingCellsIso() {
            MakeIsometricWorld();
            ga.setCamera(125,125);

            gameWorld.Cells[125][124].BlockType = GAME_WORLD_CELL_BLOCK;
            gameWorld.Cells[125][124].Sprite = null; //clear the cell

            gameWorld.Cells[124][124].BlockType = GAME_WORLD_CELL_BLOCK;
            gameWorld.Cells[124][124].Sprite= null; //clear the cell

            gameWorld.Cells[124][125].BlockType = GAME_WORLD_CELL_BLOCK;
            gameWorld.Cells[124][125].Sprite = null; //clear the cell

            gameWorld.Cells[125][126].BlockType = GAME_WORLD_CELL_BLOCK;
            gameWorld.Cells[125][126].Sprite = null; //clear the cell

            gameWorld.Cells[126][126].BlockType = GAME_WORLD_CELL_BLOCK;
            gameWorld.Cells[126][126].Sprite = null; //clear the cell

            gameWorld.Cells[126][125].BlockType = GAME_WORLD_CELL_BLOCK;
            gameWorld.Cells[126][125].Sprite = null; //clear the cell

            wolf = werewolf_Sprite(ga);

            gameWorldModel.placeSpriteInCenterOfWorldCell(125, 125, wolf);

            wolf.setSpeed(5);
            ga.defineSprite(wolf);

            //indicate redraw backdrop
            ga.markBackDropRedraw();

            var intervalid = setInterval(function () {
                if (wolf.isLoadComplete() && worldCells.isLoadComplete()) {
                    ga.play();
                    clearInterval(intervalid);
                    var counter = 0;
                    var moveTimer = setInterval(function () {
                        if (counter < 10) {
                            wolf.moveUp();
                        }
                        if (counter > 10) {
                            wolf.moveRight();
                        }
                        if (counter > 20) {
                            wolf.moveDown();
                        }
                        if (counter > 30) {
                            wolf.moveLeft();
                        }
                        if (counter > 40) {
                            console.log("Pass");
                            clearInterval(moveTimer);
                        }
                        counter++;
                    }, 100);
                }
            }, 100);


        }


        //todo: we detect blocking correctly, but where we block and where we render seem to be two totally different thigns - need to work that out.
        function BlockingCells() {

            Make2DWorld();

            //create a wall of blocking cells
            var col = 2;

            //loop through lengh
            for (var i = 0; i < 10; i++) {
                gameWorld.Cells[col][i].BlockType =  GAME_WORLD_CELL_BLOCK;
                gameWorld.Cells[col][i].Sprite = null; //clear the cell
            }

            //indicate redraw backdrop
            ga.markBackDropRedraw();

            //now we should have a column of blank (white sprites) - could be troublesome for 2.5d

            //make werewolf
            wolf = werewolf_Sprite(ga);
            wolf.setTop(50);
            wolf.setLeft(0);
            wolf.setSpeed(5);
            ga.defineSprite(wolf);

            //set timer, move werewolf, have him be blocked at column for 5-10 seconds, pass
            //if wolf's left is > value then fail
            var interval = setInterval(function () {
                if (worldCells.isLoadComplete() && wolf.isLoadComplete()) {
                    clearInterval(interval);
                    ga.play();
                    var counter = 0;
                    interval = setInterval(function () {
                        //move sprite right
                        counter++;
                        if (counter < 100) {
                            wolf.moveRight();
                        }
                        else {
                            console.log("PASS");
                            ga.removeSprite("werewolf");
                            clearInterval(interval);
                        }

                    }, 100);
                }
            }, 100);
        }

        function MakeIsometricWorld() {

            //set up new engine that will have a composite backdrop

            ga.stop(); //you have to stop the engine before you reset.
            ga.clear();
            ga.setBackDrop(undefined);

            //tell the engine our gameworld will consist of a 250x250 grid of 160,79 cells
            var gameWorld = new GameWorld(250, 250, 73, 73,GAME_WORLD_STYLE_ISOMETRIC);

            worldCells = altarCells_Sprite(ga);
            worldCells.setup(ga);

            //loop through the matrix and populate it with cells
            for (var i = 0; i < 250; i++) {
                for (var ii = 0; ii < 250; ii++) {
                    //set a cell using the worldCells sprite, randomly select one of the 25 frames in this sprite.
                    gameWorld_setCell(gameWorld, i, ii, worldCells, getRand(5), GAME_WORLD_CELL_UNDERLAY, GAME_WORLD_CELL_OPEN);
                }
            }

            ga.setWorld(gameWorld);
        }

        function MakeTestIsoMetricWorld() {
            //set up new engine that will have a composite backdrop

            ga.stop(); //you have to stop the engine before you reset.
            ga.clear();
            ga.setBackDrop(undefined);

            //tell the engine our gameworld will consist of a 250x250 grid of 160,79 cells
            var gameWorld = new GameWorld(250, 250, 30, 30, GAME_WORLD_STYLE_ISOMETRIC_GRID_TEST);

            //loop through the matrix and populate it with cells
            for (var i = 0; i < 250; i++) {
                for (var ii = 0; ii < 250; ii++) {
                    //set a cell using the worldCells sprite, randomly select one of the 25 frames in this sprite.
                    gameWorld_setCell(gameWorld, i, ii, null, 0, GAME_WORLD_CELL_UNDERLAY, GAME_WORLD_CELL_OPEN);
                }
            }

            ga.setWorld(gameWorld);
        }

        function MakeBlock()
        {

            gameWorld_setCell(gameWorld, 129, 129, null, 0, GAME_WORLD_CELL_UNDERLAY, GAME_WORLD_CELL_BLOCK);
            gameWorld_setCell(gameWorld, 130, 132, null, 0, GAME_WORLD_CELL_UNDERLAY, GAME_WORLD_CELL_BLOCK);
            gameWorld_setCell(gameWorld, 128, 115, null, 0, GAME_WORLD_CELL_UNDERLAY, GAME_WORLD_CELL_BLOCK);
        }

        function RandomBlocks(num) {
            var model = ga.getWorldModel();
            for (var i = 0; i < num; i++) {
                var cell = model.getRandomOnScreenCell();
                var worldCell = model.getWorldCellFromVisibleCell(cell.x, cell.y);
                if (worldCell.x != 125 && worldCell.y != 125) {
                    ga.getWorld().Cells[worldCell.x][worldCell.y].BlockType = GAME_WORLD_CELL_BLOCK;
                }
            }
            ga.markBackDropRedraw();
        }

        function Make2DWorld() {

            //set up new engine that will have a composite backdrop

            ga.stop(); //you have to stop the engine before you reset.
            ga.clear();
            ga.setBackDrop(undefined);

            //tell the engine our gameworld will consist of a 250x250 grid of 160,79 cells
            var gameWorld = new GameWorld(250, 250, 96,96,GAME_WORLD_STYLE_2D);

            worldCells = test2DCells_Sprite(ga);
            worldCells.setup(ga);

            //loop through the matrix and populate it with cells
            for (var i = 0; i < 100; i++) {
                for (var ii = 0; ii < 100; ii++) {
                    //set a cell using the worldCells sprite, randomly select one of the 25 frames in this sprite.
                    gameWorld_setCell(gameWorld, i, ii, worldCells, getRand(4), GAME_WORLD_CELL_UNDERLAY, GAME_WORLD_CELL_OPEN);
                }
            }
            ga.setWorld(gameWorld);
        }


        function PosToCell2D() {
            Make2DWorld();
            var rect = new Sprite("rect", "rect", "rect");
            rect.setup(ga);
            rect.setTop(0);
            rect.setLeft(0);
            rect.setWidth(ga.getWorld().CellWidth);
            rect.setHeight(ga.getWorld().CellHeight);
            rect.setCustomRoutine(function () {

                var context = ga.getMainContext();
                context.fillStyle = '#f00'; // red
                context.lineWidth = 1;
                context.strokeRect(rect.getLeft(), rect.getTop(), ga.getWorld().CellWidth, ga.getWorld().CellHeight);
                rect.setInvalidationRect(rect.getLeft(), rect.getTop(), ga.getWorld().CellWidth, ga.getWorld().CellHeight);
            });
            ga.defineSprite(rect);
            ga.addEventBehavior(ga.gameEvents.MouseDown, "", rect, "rect", function (e) {

                //convert offsety + offsetx into a Cell
                var worldModel = ga.getWorldModel();
                var cell = worldModel.getOnScreenCellAtPosition(e.offsetX, e.offsetY);
                var pos = worldModel.getOnScreenCellXY(cell.x, cell.y);
                rect.setTop(pos.y);
                rect.setLeft(pos.x);
            }, 1);

            var intervalid = setInterval(function () {
                if (worldCells.isLoadComplete()) {
                    clearInterval(intervalid);
                    ga.setCamera(100, 100);
                    ga.play();
                }
            }, 100);
        }

        function IsoSprites() {
            MakeIsometricWorld();
            var rect = new Sprite("rect", "rect", "rect");
            rect.setup(ga);
            rect.setTop(0);
            rect.setLeft(0);
            rect.setWidth(ga.getWorld().CellWidth);
            rect.setHeight(ga.getWorld().CellHeight);
            rect.setCustomRoutine(function () {
                var context = ga.getMainContext();
                context.strokeStyle = "red";
                var gameWorldModel = ga.getWorldModel();
                var cell = gameWorldModel.getCell(rect.getTop(), rect.getLeft());
                var cellPoints = gameWorldModel.getCellBoundaries(cell.x, cell.y);
                context.beginPath();
                context.moveTo(cellPoints.point1.x, cellPoints.point1.y);
                context.lineTo(cellPoints.point2.x, cellPoints.point2.y);
                context.lineTo(cellPoints.point3.x, cellPoints.point3.y);
                context.lineTo(cellPoints.point4.x, cellPoints.point4.y);
                context.lineTo(cellPoints.point1.x, cellPoints.point1.y);
                context.stroke();
                context.closePath();

            });
            ga.defineSprite(rect);
            ga.addEventBehavior(ga.gameEvents.MouseDown, "", rect, "rect", function (e) {
                rect.setTop(e.offsetX);
                rect.setLeft(e.offsetY);

            }, 1);

            var intervalid = setInterval(function () {
                if (worldCells.isLoadComplete()) {
                    clearInterval(intervalid);
                    ga.setCamera(100, 100);
                    ga.play();
                    var counter = 0;
                    var intervalid = setInterval(function () {
                        count++;
                        if (counter < 100) {
                            ga.adjustCameraX(1);
                            ga.adjustCameraY(1);
                        }
                        else {
                            console.log("PASS");
                            clearInterval(intervalId);
                        }
                    }, 100);

                }
            }, 100);


        }

        function PosToGridCellIso() {
            MakeTestIsoMetricWorld();
            ga.setCamera(125,125);
            var rect = new Sprite("rect", "rect", "rect");
            rect.setup(ga);
            rect.setTop(0);
            rect.setLeft(0);
            rect.setWidth(ga.getWorld().CellWidth);
            rect.setHeight(ga.getWorld().CellHeight);
            rect.setCustomRoutine(function () {
                var context = ga.getMainContext();
                context.strokeStyle = "red";
                var gameWorldModel = ga.getWorldModel();
                var cell = gameWorldModel.getCell(rect.getTop(), rect.getLeft());
                var worldCell = gameWorldModel.getWorldCellFromScreenCoord(rect.getTop(), rect.getLeft());


                var cellPoints = gameWorldModel.getCellBoundaries(cell.x, cell.y);
                context.beginPath();
                context.moveTo(cellPoints.point1.x, cellPoints.point1.y);
                context.lineTo(cellPoints.point2.x, cellPoints.point2.y);
                context.lineTo(cellPoints.point3.x, cellPoints.point3.y);
                context.lineTo(cellPoints.point4.x, cellPoints.point4.y);
                context.lineTo(cellPoints.point1.x, cellPoints.point1.y);
                context.stroke();
                context.closePath();

            });
            ga.defineSprite(rect);
            ga.addEventBehavior(ga.gameEvents.MouseDown, "", rect, "rect", function (e) {
                rect.setTop(e.offsetX);
                rect.setLeft(e.offsetY);
                var gameWorldModel = ga.getWorldModel();
                var cell = gameWorldModel.getCell(rect.getTop(), rect.getLeft());
                var worldCell = gameWorldModel.getWorldCellFromScreenCoord(rect.getTop(), rect.getLeft());

                console.log("World Cell: " + worldCell.x + "," + worldCell.y);
                console.log("Visible Cell: " + cell.x + "," + cell.y);

            }, 1);
            ga.play();
        }

        function DrawGridKeepHighlight() {
            MakeTestIsoMetricWorld();
            ga.setCamera(125,125);

            var rect = new Sprite("rect", "rect", "rect");
            rect.setup(ga);
            rect.setTop(0);
            rect.setLeft(0);
            rect.setWidth(ga.getWorld().CellWidth);
            rect.setHeight(ga.getWorld().CellHeight);
            rect.setCustomRoutine(function () {
                var context = ga.getMainContext();
                context.strokeStyle = "red";
                var gameWorldModel = ga.getWorldModel();
                var pos = gameWorldModel.getVisibleCellFromWorldCell(250, 250);
                var cellPoints = gameWorldModel.getCellBoundaries(pos.x, pos.y);
                context.beginPath();
                context.moveTo(cellPoints.point1.x, cellPoints.point1.y);
                context.lineTo(cellPoints.point2.x, cellPoints.point2.y);
                context.lineTo(cellPoints.point3.x, cellPoints.point3.y);
                context.lineTo(cellPoints.point4.x, cellPoints.point4.y);
                context.lineTo(cellPoints.point1.x, cellPoints.point1.y);
                context.stroke();
                context.closePath();

            });
            ga.defineSprite(rect);


            ga.play();
            var counter = 0;
            var intervalid = setInterval(function () {
                counter++;
                if (counter < 5) {
                    ga.adjustCameraX(1);
                }
                else {
                    console.log("PASS");
                    clearInterval(intervalid);
                }
            }, 100);

        }

        function DrawGrid() {
            MakeTestIsoMetricWorld();
            ga.setCamera(125,125);
            ga.play();
            var counter = 0;
            var intervalid = setInterval(function () {
                count++;
                if (counter < 10) {
                    ga.adjustCameraX(1);
                }
                else {
                    console.log("PASS");
                    clearInterval(intervalid);
                }
            }, 100);
        }

	  var paths = [];
	  var current = { x:250, y:250};
	  var gameWorldModel;
	  var zombieIntervalId;
	  var zom;
	  var currentGoal = 0;
	  function FindPath()
	  {

            MakeTestIsoMetricWorld();
            ga.setCamera(125, 125);
            RandomBlocks(50);
			zom = zombie_Sprite(ga, "zombo");

			var id = setInterval(function () {
			    if (zom.isLoadComplete()) {
			        clearInterval(id);
			        zom.setSpeed(3);
			        zom.setInnerDrawRectOverride(40, 60);
			        ga.defineSprite(zom);
			        var seeker = new Seeker("walking", "attacking", 100);
			        gameWorldModel = ga.getWorldModel();
			        gameWorldModel.placeSpriteInCenterOfWorldCell(125, 125, zom);
			        ga.play();
			        // function (eventName, eventData, sprite, animationName, actionClass, actionPlayCount)
			        ga.addEventBehavior(ga.gameEvents.MouseDown, "", zom, "walking", seeker, -1);
			        ga.addEventBehavior(ga.gameEvents.MouseDown, "", undefined, "walking", function (event, engine, sprite) {
			            console.log("click: (" + event.offsetX + "," + event.offsetY + ")");
			            var cell = gameWorldModel.getWorldCellFromScreenCoord(event.offsetX, event.offsetY);
			            console.log("cell: (" + cell.x + "," + cell.y + ")");
			        }, -1);
			    }

			}, 100);

        }

        function FindSprite() {

            MakeTestIsoMetricWorld();
            ga.setCamera(125,125);
            RandomBlocks(50);

            zom = zombie_Sprite(ga, "zombo");
            var zom2 = zombie_Sprite(ga, "zombo2");

            var id = setInterval(function () {
                if (zom.isLoadComplete() && zom2.isLoadComplete()) {
                    clearInterval(id);
                    zom.setSpeed(6);
                    ga.defineSprite(zom);

                    zom2.setSpeed(3);
                    ga.defineSprite(zom2);

                    var seeker = new Seeker("walking", "attacking", 100);
                    var spseeker = new SpriteSeeker("walking", "attacking", 200, zom);
                    gameWorldModel = ga.getWorldModel();
                    gameWorldModel.placeSpriteInCenterOfWorldCell(125, 125, zom);
                    gameWorldModel.placeSpriteInCenterOfWorldCell(125, 124, zom2);
                    ga.play();

                    // function (eventName, eventData, sprite, animationName, actionClass, actionPlayCount)
                    ga.addEventBehavior(ga.gameEvents.MouseDown, "", zom, "walking", seeker, -1);
                    ga.addEventBehavior(ga.gameEvents.NPC, "", zom2, "walking", spseeker, playInfinite);
                    ga.addEventBehavior(ga.gameEvents.MouseDown, "", undefined, "walking", function (event, engine, sprite) {
                        console.log("click: (" + event.offsetX + "," + event.offsetY + ")");
                        var cell = gameWorldModel.getWorldCellFromScreenCoord(event.offsetX, event.offsetY);
                        console.log("cell: (" + cell.x + "," + cell.y + ")");
                    }, -1);
                }

            }, 100);
        }


        function SortOrder() {
            MakeIsometricWorld();
            var col = columnCell_Sprite(ga, "column0");
            var zom = zombie_Sprite(ga, "zombo");
            var col4 =columnCell_Sprite(ga, "column4");

            gameWorld_setCell(gameWorld, 127, 127, columnCell_Sprite(ga, "column1"), 0, GAME_WORLD_CELL_OVERLAY, GAME_WORLD_CELL_BLOCK);
            gameWorld_setCell(gameWorld, 125, 126, columnCell_Sprite(ga, "column2"), 0, GAME_WORLD_CELL_OVERLAY, GAME_WORLD_CELL_BLOCK);
            gameWorld_setCell(gameWorld, 127, 126, columnCell_Sprite(ga, "column3"), 0, GAME_WORLD_CELL_OVERLAY, GAME_WORLD_CELL_BLOCK);
            gameWorld_setCell(gameWorld, 126, 127, col4, 0, GAME_WORLD_CELL_OVERLAY, GAME_WORLD_CELL_BLOCK);

            ga.defineSprite(zom);
            ga.setWorld(gameWorld);
            ga.setCamera(125, 125);
            var model = ga.getWorldModel();
            model.placeSpriteInCenterOfWorldCell(127, 128, zom);
            var id = setInterval(function () {
                if (col.isLoadComplete() && zom.isLoadComplete()) {
                    clearInterval(id);
                    ga.play();
                    var id = setInterval(function () {
                        clearInterval(id);
                        zom.setTop(zom.getTop() - 50);
                        var map = ga.getOverLayMap();
                        var order = ga.getSortedSpriteArray();
                        //make sure order is in y
                        if (order[0].name != "column1") { throw "Sprite order 0 is wrong."; }
                        if (order[1].name != "column4") { throw "Sprite order 1 is wrong."; }
                        if (order[2].name != "column2") { throw "Sprite order 2 is wrong."; }
                        if (order[3].name != "column3") { throw "Sprite order 3 is wrong."; }

                        console.log("pass");

                    }, 1000);
                }
            }, 100);
        }

        function PlayerMovementPOV() {

            MakeTestIsoMetricWorld();
            ga.setCamera(125, 125);
            RandomBlocks(50);
            zom = zombie_Sprite(ga, "zombo");

            var id = setInterval(function () {
                if (zom.isLoadComplete()) {
                    clearInterval(id);
                    zom.setSpeed(2);
                    ga.defineSprite(zom);

                    var seeker = new OriginSeeker("walking", "attacking", 100);
                    gameWorldModel = ga.getWorldModel();
                    gameWorldModel.placeSpriteInCenterOfWorldCell(125, 125, zom);
                    ga.play();

                    // function (eventName, eventData, sprite, animationName, actionClass, actionPlayCount)
                    ga.addEventBehavior(ga.gameEvents.MouseDown, "", undefined, "walking", function (event, engine, sprite) {
                        console.log("click: (" + event.offsetX + "," + event.offsetY + ")");
                    }, -1);
                    ga.addEventBehavior(ga.gameEvents.MouseDown, "", zom, "walking", seeker, -1);
                }

            }, 100);
        }



        function PlacementTest() {

            MakeTestIsoMetricWorld();
            ga.setCamera(125, 125);
            RandomBlocks(50);
            zom = zombie_Sprite(ga, "zombo");

            var id = setInterval(function () {
                if (zom.isLoadComplete()) {
                    clearInterval(id);
                    zom.setSpeed(2);
                    ga.defineSprite(zom);

                    gameWorldModel = ga.getWorldModel();
                    gameWorldModel.placeSpriteInCenterOfWorldCell(125, 125, zom);
                    ga.play();

                    // function (eventName, eventData, sprite, animationName, actionClass, actionPlayCount)
                    ga.addEventBehavior(ga.gameEvents.MouseDown, "", undefined, "walking", function (event, engine, sprite) {

                        var cell = gameWorldModel.getWorldCellFromSprite(zom);
                        if (cell.x != 125 && cell.y != 125) {
                            throw "Not in the cell I set!";
                        }

                    }, -1);

                }

            }, 100);
        }

        function OriginTest() {

            MakeTestIsoMetricWorld();
            ga.setCamera(125, 125);
            RandomBlocks(50);
            var zom = zombie_Sprite(ga, "zombo");
            ga.defineSprite(zom);
            var id = setInterval(function () {
                if (zom.isLoadComplete()) {
                    clearInterval(id);
                    gameWorldModel = ga.getWorldModel();
                    gameWorldModel.placeSpriteInCenterOfWorldCell(125, 125, zom);
                    ga.play();

                    // function (eventName, eventData, sprite, animationName, actionClass, actionPlayCount)
                    var counts = [];
                    counts.length = 4;
                    counts[0] = 0;
                    counts[1] = 0;
                    counts[2] = 0;
                    counts[3] = 0;
                    var ids = [];
                    ids.length = 4;
                    var distance = 10;

                    //origin:
                    //x =+inf to -inf
                    //y =
                    //+inf
                    //to
                    //-inf

                    ga.addEventBehavior(ga.gameEvents.KeyDown, RIGHTARROW, undefined, undefined, function (event, engine, sprite) {
                        ids[0] = setInterval(moveOrigin("x", 5, 0), 100);
                    }, 1);

                    ga.addEventBehavior(ga.gameEvents.KeyDown, LEFTARROW, undefined, undefined, function (event, engine, sprite) {
                        ids[1] = setInterval(moveOrigin("x", -5, 1), 100);
                    }, 1);

                    ga.addEventBehavior(ga.gameEvents.KeyDown, UPARROW, undefined, undefined, function (event, engine, sprite) {
                        ids[2] = setInterval(moveOrigin("y", 5, 2), 100);
                    }, 1);

                    ga.addEventBehavior(ga.gameEvents.KeyDown, DOWNARROW, undefined, undefined, function (event, engine, sprite) {
                        ids[3] = setInterval(moveOrigin("y", -5, 3), 100);
                    }, 1);


                    ga.addEventBehavior(ga.gameEvents.MouseDown, undefined, undefined, undefined, function (event, engine, sprite) {
                        //                        var mmsg = "Mouse: (" + event.offsetX + "," + event.offsetY + ")";
                        //                        console.log(mmsg);
                        //reverse
                        //                        console.log("click: (" + event.offsetX + "," + event.offsetY + ")");
                        //
                        //                        var distanceFromCenterX= gameWorldModel.canvasWidth/2 - event.offsetX;
                        //                        var distanceFromCenterY = gameWorldModel.canvasHeight / 2 - event.offsetY;
                        //                        console.log("distances: (" + distanceFromCenterX + "," + distanceFromCenterY + ")");

                        //                        console.log("oldOrigin: (" + ga.getOriginX() + "," + ga.getOriginY() + ")");

                        //                        var newOriginX = ga.getOriginX() + distanceFromCenterX;
                        //                        var newOriginY = ga.getOriginY() + distanceFromCenterY;
                        //                        console.log("newOrigin: (" + newOriginX + "," + newOriginY+ ")");

                        //                        ga.setOriginX(newOriginX);
                        //                        ga.setOriginY(newOriginY);
                        zom.moveOriginToPoint({ "x": event.offsetX, "y": event.offsetY });
                    }, 1);


                    function moveOrigin(direction, speed, val) {
                        ga.adjustOrigin(direction, speed, zom);
                        counts[val]++;
                        if (counts[val] < distance) {
                            clearInterval(ids[val]);
                            counts[val] = 0; //
                        }
                        var msg = "Origin: (" + ga.getOriginX() + "," + ga.getOriginY() + ")";
                        console.log(msg);
                    }
                }
            }, 100);

        }





        function SegmentedLine()  { //

            MakeTestIsoMetricWorld();
            ga.setCamera(125, 125);
            ga.play();
            var context = ga.getMainContext();
            context.strokeStyle = "red";
            var point = { "x": ga.getOriginX(), "y": ga.getOriginY() };
            if (this.once == undefined) {
                context.beginPath();
                context.moveTo(point.x, point.y);
                this.once = 0;
            }


            var intervalId = -1;
            ga.addEventBehavior(ga.gameEvents.MouseDown, undefined, undefined, undefined, function (e) {

                //draw a line from start point (origin) to click
                var endPoint = { "x": e.offsetX, "y": e.offsetY };
                clearInterval(intervalId);
                intervalId = setInterval(function () {
                    var nextPoint = astar.nextPoint(point, endPoint, 5);
                    context.lineTo(nextPoint.x, nextPoint.y);
                    context.stroke();

                    point = nextPoint;
                }, 500);


            }, -1);

        }

        function AStarLine() { //

            MakeTestIsoMetricWorld();
            ga.setCamera(125, 125);
            RandomBlocks(15);

            ga.play();
            var model = ga.getWorldModel();
            var context = ga.getMainContext();
            context.strokeStyle = "red";
            var point = { "x": 125, "y": 125};

            var startCell = model.getWorldCellFromScreenCoord(point.x, point.y);


            var intervalId = -1;
            ga.addEventBehavior(ga.gameEvents.MouseDown, undefined, undefined, undefined, function (e) {

                //draw a line from start point (origin) to click
                var endPoint = { "x": e.offsetX, "y": e.offsetY };
                var endCell = model.getWorldCellFromScreenCoord(endPoint.x, endPoint.y);
                var path = astar.search(ga.getWorld().Cells, startCell, endCell, model, undefined);
                var pathPoints = astar.pathToPoints(path, model, 5);

                clearInterval(intervalId);
                var counter = 0;
                intervalId = setInterval(function () {

                    if (AStarLine.once == undefined) {
                        context.beginPath();
                        context.moveTo(point.x, point.y);
                        context.lineTo(point.x, point.y);
                        context.stroke();
                        AStarLine.once = 0;
                    }

                    if (counter < pathPoints.length) {
                        var nextPoint = pathPoints[counter];
                        context.lineTo(nextPoint.x, nextPoint.y);
                        context.stroke();
                        counter++;
                    }
                    else {
                        startCell = endCell;
                    }
                }, 100);


            }, -1);

        }


        function SmoothAStarLine() { //

            MakeTestIsoMetricWorld();
            ga.setCamera(125, 125);
            RandomBlocks(50);

            ga.play();
            var model = ga.getWorldModel();
            var context = ga.getMainContext();
            context.strokeStyle = "red";
            var point = { "x": 125, "y": 125 };

            var startCell = model.getWorldCellFromScreenCoord(point.x, point.y);


            var intervalId = -1;
            ga.addEventBehavior(ga.gameEvents.MouseDown, undefined, undefined, undefined, function (e) {

                //draw a line from start point (origin) to click
                var endPoint = { "x": e.offsetX, "y": e.offsetY };
                var endCell = model.getWorldCellFromScreenCoord(endPoint.x, endPoint.y);
                var path = astar.search(ga.getWorld().Cells, startCell, endCell, model, undefined);
                path = astar.smoothPath(path, 50, model);
                var pathPoints = astar.pathToPoints(path, model, 15);

                clearInterval(intervalId);
                var counter = 0;
                intervalId = setInterval(function () {

                    if (SmoothAStarLine.once == undefined) {
                        context.beginPath();
                        context.moveTo(point.x, point.y);
                        context.lineTo(point.x, point.y);
                        context.stroke();
                        SmoothAStarLine.once = 0;
                    }

                    if (counter < pathPoints.length) {
                        var nextPoint = pathPoints[counter];
                        context.lineTo(nextPoint.x, nextPoint.y);
                        context.stroke();
                        counter++;
                    }
                    else {
                        startCell = endCell;
                    }
                }, 100);


            }, -1);

        }




        function PlayerMovementPOVFollowers() {

            MakeTestIsoMetricWorld();
            MakeBlock();
            ga.setCamera(125, 125);
            RandomBlocks(50);
            zom = zombie_Sprite(ga, "zombo");
            var zom2 = zombie_Sprite(ga, "zombo2");

            var rect = new Sprite("rect", "rect", "rect");
            rect.setup(ga);
            rect.setTop(0);
            rect.setLeft(0);
            rect.setWidth(ga.getWorld().CellWidth);
            rect.setHeight(ga.getWorld().CellHeight);
            rect.setCustomRoutine(function () {
                var context = ga.getMainContext();
                context.strokeStyle = "red";
                var gameWorldModel = ga.getWorldModel();
                var cell = gameWorldModel.getCell(rect.getTop(), rect.getLeft());
                var worldCell = gameWorldModel.getWorldCellFromScreenCoord(rect.getTop(), rect.getLeft());


                var cellPoints = gameWorldModel.getCellBoundaries(cell.x, cell.y);
                context.beginPath();
                context.moveTo(cellPoints.point1.x, cellPoints.point1.y);
                context.lineTo(cellPoints.point2.x, cellPoints.point2.y);
                context.lineTo(cellPoints.point3.x, cellPoints.point3.y);
                context.lineTo(cellPoints.point4.x, cellPoints.point4.y);
                context.lineTo(cellPoints.point1.x, cellPoints.point1.y);
                context.stroke();
                context.closePath();

            });
            ga.defineSprite(rect);


            var id = setInterval(function () {
                if (zom.isLoadComplete() && zom2.isLoadComplete()) {
                    clearInterval(id);
                    zom.setSpeed(6);
                    ga.defineSprite(zom);

                    zom2.setSpeed(2);
                    ga.defineSprite(zom2);

                    var seeker = new OriginSeeker("walking", "attacking",100);
                    var spseeker = new SpriteSeeker("walking", "attacking", 200, zom);
                    gameWorldModel = ga.getWorldModel();
                    gameWorldModel.placeSpriteInCenterOfWorldCell(125, 125, zom);
                    gameWorldModel.placeSpriteInCenterOfWorldCell(128, 128, zom2);
                    ga.play();
                    var mouseStillDown = 0;


                    ga.addEventBehavior(ga.gameEvents.MouseDown, "", zom, "walking", seeker, playInfinite);
                    ga.addEventBehavior(ga.gameEvents.NPC, "", zom2, "walking", spseeker, playInfinite);
                }

            }, 100);
        }


        function PlayerMovementPOVFollowersWithCollisions() {

            MakeTestIsoMetricWorld();
            MakeBlock();
            ga.setCamera(125, 125);
            RandomBlocks(50);
            zom = zombie_Sprite(ga, "zombo");
            var zom2 = zombie_Sprite(ga, "zombo2");


            var id = setInterval(function () {
                if (zom.isLoadComplete() && zom2.isLoadComplete()) {
                    clearInterval(id);
                    zom.setSpeed(6);
                    ga.defineSprite(zom);

                    zom2.setSpeed(2);
                    ga.defineSprite(zom2);

                    var seeker = new OriginSeeker("walking", "attacking", 100);
                    var spseeker = new SpriteSeeker("walking", "attacking", 200, zom);
                    gameWorldModel = ga.getWorldModel();
                    gameWorldModel.placeSpriteInCenterOfWorldCell(125, 125, zom);
                    gameWorldModel.placeSpriteInCenterOfWorldCell(128, 128, zom2);


                    ga.addEventBehavior(ga.gameEvents.MouseDown, "", zom, "walking", seeker, playInfinite);
                    ga.addEventBehavior(ga.gameEvents.MouseDown, "", undefined, undefined, function (event) {
                        //highlight the cell,
                        highlightCell(event);
                    }, playInfinite);


                    ga.addEventBehavior(ga.gameEvents.NPC, "", zom2, "walking", spseeker, playInfinite);
                    ga.setCollisionHandler(function (sprite1, sprite2) {

                        if (sprite1.getSpriteState() == "attacking") {
                            sprite2.setSpriteState("headsplode");
                        }

                        if (sprite2.getSpriteState() == "attacking") {
                            sprite1.setSpriteState("headsplode");
                        }
                    });
                    ga.play();
                }

            }, 100);
        }

        function highlightCell(event) {
            var context = ga.getMainContext();
            context.strokeStyle = "red";
            var gameWorldModel = ga.getWorldModel();
            var cell = gameWorldModel.getCell(event.offsetX, event.offsetY);
            var cellPoints = gameWorldModel.getCellBoundaries(cell.x, cell.y);
            context.beginPath();
            context.moveTo(cellPoints.point1.x, cellPoints.point1.y);
            context.lineTo(cellPoints.point2.x, cellPoints.point2.y);
            context.lineTo(cellPoints.point3.x, cellPoints.point3.y);
            context.lineTo(cellPoints.point4.x, cellPoints.point4.y);
            context.lineTo(cellPoints.point1.x, cellPoints.point1.y);
            context.stroke();
            context.closePath();
        }

        function CompositeSprite() {
            MakeTestIsoMetricWorld();
            MakeBlock();
            ga.setCamera(125, 125);

            //use case: sprite = new sprite(class, weaponClass, {head, tr etc etc etc});
            //engine,
            var compositeDef = {
                "tokenClass":"AM",
                "weaponClass":"BOW",
                "HD":"CAP",
                "TR":"HVY",
                "LG":"HVY",
                "RA":"HVY",
                "LA":"HVY",
                "RH":"PIK",
                "LH":"LBB",
                "SH": "BUC",
                "S1":undefined,
                "name": "amazonGirl"
            };

            var am;
            createCompositSprite(ga, compositeDef, function (sprite) {
                am = sprite;
                am.boxSprite("#f00");
            });

            var id = setInterval(function () {
                if (am != undefined && am.isLoadComplete()) {
                    ga.defineSprite(am);
                    var gameWorldModel = ga.getWorldModel();
                    gameWorldModel.placeSpriteInCenterOfWorldCell(127, 127, am);
                    ga.play();
                    clearInterval(id);
                }

            }, 100);


        }

    </script>
</head>

<body onload="ready()">
    <canvas id="gamescreen" width="200" height="200" style="border-style: dotted; float: left;">
        No supporty canvisimo!
    </canvas>
    <canvas id="backbuffer2" width="200" height="200" style="border-style: dotted; float: left;"></canvas>
    <div>


        <a href="#" onclick="animationLoop()">Run simple animation loop tests</a><br />
        <a href="#" onclick="positionTests()">Run position tests</a><br />
        <a href="#" onclick="watcherTests()">Run all frame watcher tests</a><br />
        <a href="#" onclick="lastFrameWatcherTests()">Run last frame watcher tests</a><br />
        <a href="#" onclick="targetFrameWatcherTests()">Run target frame watcher tests</a><br />
        <a href="#" onclick="addRemoveSprite()">Add/Remove Sprite Test</a><br />
        <a href="#" onclick="attachInput()">Test Attached Input</a><br />
        <a href="#" onclick="collisionTest()">Test Sprite Collision</a><br />
        <a href="#" onclick="compositeBackDrop(GAME_WORLD_STYLE_2D)">Test Multi-Celld Backgrounds
            2D</a><br />
        <a href="#" onclick="compositeBackDrop(GAME_WORLD_STYLE_ISOMETRIC)">Test Multi-Celled
            Backgrounds Mock 3D</a><br />
        <a href="#" onclick="compositeBackDropWithSprite()">Test Multi-Celled Backgrounds Mock
            3D - With sprite</a><br />
        <a href="#" onclick="scalingDepth()">Test Mock 3D Scaling Depth</a><br />
        <a href="#" onclick="PosToCell2D()">Position To Cell 2D</a><br />
        <a href="#" onclick="DrawGrid()">Draw an Iso grid</a><br />
        <a href="#" onclick="DrawGridKeepHighlight()">Iso Cell Location</a><br />
        <a href="#" onclick="PosToGridCellIso()">Position To Cell Isometric</a><br />
        <a href="#" onclick="IsoSprites()">Iso Sprite Cells</a><br />
        <a href="#" onclick="BlockingCells()">Blocking Cells 2D</a><br />
        <a href="#" onclick="BlockingCellsIso()">Blocking Cells Iso</a><br />
        <a href="#" onclick="SegmentedLine()">Segmented Line (pathing)</a><br />
        <a href="#" onclick="AStarLine()">AStar Line (pathing)</a><br />
        <a href="#" onclick="SmoothAStarLine()">Smooth AStar Line (pathing)</a><br />
        <a href="#" onclick="PlayerMovementPOVFollowers()">POV Movement w/ Follow</a><br />

        <a href="#" onclick="FindPath()">Find Path</a><br />
        <a href="#" onclick="FindSprite()">Find Sprite</a><br />

        <a href="#" onclick="OriginTest()">OriginTest</a><br />
        <a href="#" onclick="PlayerMovementPOV()">POV Movement</a><br />
        <a href="#" onclick="PlayerMovementPOVFollowers()">POV Movement w/ Followers </a><br />
        <a href="#" onclick="PlayerMovementPOVFollowersWithCollisions()">POV Movement w/ Followers and collisions</a><br />
        <a href="#" onclick="PlacementTest()">Placement Test</a><br />
        <a href="#" onclick="SortOrder()">Sprite Sort Order</a><br />
        <a href="#" onclick="CompositeSprite()">Composite Sprite</a><br />


        <!---implement me
        <a href="#" onclick="Overlays()">Overlays 2D</a><br />
        <a href="#" onclick="Overlays()">Overlays Iso</a><br />--->
        <!---implement me
        <a href="#" onclick="CompositeSprite()">CompositeSprite</a><br />
        --->
        <!--- 2d edit to cell map to iso map --->
        <!--- persist to cassandra/data model --->
        <!--- detail editor, drop actual sprites --->
        <!--- write some clean up code so you can quickly run the unit tests. They shit all over each other right now--->
    </div>
    <div id="frameDebug">
    </div>
</body>
</html>
